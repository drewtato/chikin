!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(1));window.addEventListener("load",()=>{let e=o.sleep(1e3);o.screenlog("Loaded page"),Promise.all([i,l,e]).then(e=>{o.gameload(e[0],e[1])})});let i=fetch("meta.json").then(e=>e.json()),l=fetch("tiles.txt").then(e=>e.text())},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function l(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(l,a)}c((r=r.apply(e,t||[])).next())})};function o(e){return new Promise(t=>setTimeout(t,e))}function i(e){let t=document.getElementById("screenlog");if(null===t)return void console.log(e);let n=document.createElement("p");Array.isArray(e)||(e=[e]);for(let t of e)n.innerHTML+=void 0===t?"undefined":"object"==typeof t?JSON.stringify(t):t.toString(),n.innerHTML+=" ";t.appendChild(n),t.scrollTop=t.scrollHeight}function l(e,t,n){let r=performance.now();requestAnimationFrame(function o(i){let l=(i-r)/e;l>1&&(l=1),l<0&&(l=0);let a=t(l);n(a),l<1&&requestAnimationFrame(o)})}function a(e,t,n){return r(this,void 0,void 0,function*(){l(e,t,n),yield o(e)})}function c(){let e=document.getElementById("game");if(null===e)throw"No game area";let t=Math.floor(.9*e.clientHeight),n=Math.floor(.9*e.clientWidth),r=Math.min(t,n),o=e.style;o.setProperty("--proportion","10"),o.setProperty("--size",`${r}px`)}function s(e,t){let n=function(){let e=document.createElement("div");return e.classList.add("t"),e}();if(e in t){let r=new Image;r.src=t[e].img,n.appendChild(r),"size"in t[e]&&(r.style.setProperty("height",`calc(var(--tile) * ${t[e].size[0]})`),r.style.setProperty("width",`calc(var(--tile) * ${t[e].size[1]})`))}return n}function d(e,t){e.style.setProperty("--y",`calc(${-t[0]} * var(--size) / var(--proportion))`),e.style.setProperty("--x",`calc(${-t[1]} * var(--size) / var(--proportion))`)}Object.defineProperty(t,"__esModule",{value:!0}),t.sleep=o,t.screenlog=i,t.gameload=function(e,t){return r(this,void 0,void 0,function*(){let n=function(e){let t=e.tiles,n={};for(let e in t)n[t[e].code]=e;return{data:t,codes:n}}(e),o=n.data,u=n.codes,f=function(e,t,n){let r,o=[0,0],i=[],l=e.split("\n");for(r=0;r<l.length;r++){let e=l[r].split("");if(":"===e[0])break;let a=e.indexOf(n);a>=0&&(o=[r,a]),i.push(e.map(e=>t[e]))}let a=[];for(r++;r<l.length;r++){let e=l[r].split(" "),n=e[0],o=e[1].split(",").map(e=>parseInt(e,10));a.push([t[n],o])}return[i,a,o]}(t,u,e.characters.chikin.code),p=f[0],y=f[1],h=f[2];c(),window.addEventListener("resize",c);let m=document.getElementById("game");if(null===m)throw"No game area";let v=document.createElement("div");v.classList.add("world"),m.innerHTML="",m.appendChild(v),d(v,h);let g=new Image;g.src=e.characters.chikin.img,g.classList.add("chikin"),g.alt="chikin",m.appendChild(g),i("Loaded game"),yield a(500,e=>e,e=>{g.style.opacity=e.toString()}),yield l(1e3,e=>e,e=>{v.style.opacity=e.toString()}),function(e,t,n,r,o){let i=document.createElement("div");i.classList.add("tileContainer");let a=document.createElement("div");a.classList.add("fgtiles"),i.appendChild(a);for(let e of t){let t=document.createElement("div");t.classList.add("worldRow");for(let n of e){let e=s(n,o);t.appendChild(e)}i.appendChild(t)}e.appendChild(i);for(let e of n){let t=e[0],n=e[1],r=s(t,o);r.style.setProperty("top",`calc(var(--tile) * ${n[0]})`),r.style.setProperty("left",`calc(var(--tile) * ${n[1]})`),a.appendChild(r)}l(r,e=>e,e=>{i.style.opacity=e.toString()})}(v,p,y,1e3,o),i("Done");let w=[],b=!1,P=new Set(["w","ArrowUp","s","ArrowDown","a","ArrowLeft","d","ArrowRight"]);window.onkeyup=(e=>{let t=w.indexOf(e.key);t>=0&&w.splice(t,1)}),window.onkeydown=function(e){return r(this,void 0,void 0,function*(){console.log('"'+e.key+'"'),function(e){switch(e){case" ":case"Enter":l(300,e=>Math.abs(e*(e-.5)*(e-1)*3),e=>{for(let t of document.getElementsByClassName("chikin"))t.style.setProperty("transform",`translateY(calc(${-e} * var(--tile)))`)})}}(e.key),-1===w.indexOf(e.key)&&P.has(e.key)&&w.push(e.key),b||(b=!0,yield function(e,t,n){return r(this,void 0,void 0,function*(){for(;t.length;){let r=0,o=0;switch(t[0]){case"w":case"ArrowUp":r=-1;break;case"s":case"ArrowDown":r=1;break;case"a":case"ArrowLeft":o=-1;break;case"d":case"ArrowRight":o=1;break;default:return}let i=n.slice();yield a(180,e=>e,t=>{let n=[i[0]+r*t,i[1]+o*t];d(e,n)}),n[0]+=r,n[1]+=o}})}(v,w,h),b=!1)})}})}}]);